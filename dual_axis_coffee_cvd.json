{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Coffee Consumption vs. Cardiovascular Disease Deaths (1990-2019)",
    "subtitle": "Global averages from complete datasets (joined by year, not by country)",
    "anchor": "middle",
    "fontSize": 18,
    "fontWeight": "bold"
  },
  "width": 800,
  "height": 500,
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Ng-Jun-Xian/3179-A2/main/Coffee_consumption_per_capita.csv"
      },
      "transform": [
        {"filter": "datum.Year >= 1990 && datum.Year <= 2019"},
        {
          "aggregate": [
            {"op": "mean", "field": "Consumption_Per_Capita_kg", "as": "mean_consumption"},
            {"op": "count", "as": "country_count_coffee"}
          ],
          "groupby": ["Year"]
        }
      ],
      "mark": {
        "type": "line",
        "strokeWidth": 4,
        "color": "#8B4513",
        "point": {
          "filled": true,
          "size": 80,
          "color": "#8B4513"
        }
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "quantitative",
          "title": "Year",
          "axis": {
            "format": "d",
            "tickCount": 10,
            "labelFontSize": 12,
            "titleFontSize": 14
          },
          "scale": {"domain": [1990, 2019]}
        },
        "y": {
          "field": "mean_consumption",
          "type": "quantitative",
          "title": "Average Coffee Consumption Per Capita (kg)",
          "axis": {
            "labelFontSize": 12,
            "titleFontSize": 14,
            "titleColor": "#8B4513",
            "tickCount": 6
          },
          "scale": {"zero": false}
        },
        "tooltip": [
          {"field": "Year", "type": "quantitative", "title": "Year"},
          {"field": "mean_consumption", "type": "quantitative", "title": "Average Coffee (kg)", "format": ".3f"},
          {"field": "country_count_coffee", "type": "quantitative", "title": "Countries in Coffee Data"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Ng-Jun-Xian/3179-A2/main/Coffee_consumption_per_capita.csv"
      },
      "transform": [
        {"filter": "(datum.Year == 1990 || datum.Year == 2019)"},
        {
          "aggregate": [
            {"op": "mean", "field": "Consumption_Per_Capita_kg", "as": "mean_consumption"}
          ],
          "groupby": ["Year"]
        }
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 10,
        "dy": -10,
        "fontSize": 14,
        "fontWeight": "bold",
        "color": "#8B4513"
      },
      "encoding": {
        "x": {"field": "Year", "type": "quantitative"},
        "y": {"field": "mean_consumption", "type": "quantitative"},
        "text": {
          "field": "mean_consumption",
          "type": "quantitative",
          "format": ".2f"
        }
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Ng-Jun-Xian/3179-A2/main/Coffee_consumption_per_capita.csv"
      },
      "transform": [
        {"filter": "datum.Year >= 1990 && datum.Year <= 2019"},
        {
          "aggregate": [
            {"op": "mean", "field": "Consumption_Per_Capita_kg", "as": "overall_mean"}
          ]
        }
      ],
      "mark": {
        "type": "rule",
        "strokeDash": [8, 4],
        "strokeWidth": 2,
        "color": "#8B4513"
      },
      "encoding": {
        "y": {"field": "overall_mean", "type": "quantitative"}
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Ng-Jun-Xian/3179-A2/main/cardiovascular-disease-death-rate-crude-versus-age-standardized.csv"
      },
      "transform": [
        {"filter": "datum.Year >= 1990 && datum.Year <= 2019"},
        {
          "aggregate": [
            {"op": "mean", "field": "Age-standardized deaths from cardiovascular diseases in both sexes in those aged all ages per 100,000 people", "as": "mean_cvd"},
            {"op": "count", "as": "country_count_cvd"}
          ],
          "groupby": ["Year"]
        }
      ],
      "mark": {
        "type": "line",
        "strokeWidth": 4,
        "color": "#C13838",
        "point": {
          "filled": true,
          "size": 80,
          "color": "#C13838"
        },
        "strokeDash": [6, 3]
      },
      "encoding": {
        "x": {"field": "Year", "type": "quantitative"},
        "y": {
          "field": "mean_cvd",
          "type": "quantitative",
          "title": "Average CVD Deaths (per 100,000)",
          "axis": {
            "labelFontSize": 12,
            "titleFontSize": 14,
            "titleColor": "#C13838",
            "orient": "right",
            "tickCount": 6
          },
          "scale": {"zero": false}
        },
        "tooltip": [
          {"field": "Year", "type": "quantitative", "title": "Year"},
          {"field": "mean_cvd", "type": "quantitative", "title": "Avg CVD Deaths", "format": ".1f"},
          {"field": "country_count_cvd", "type": "quantitative", "title": "Countries in CVD Data"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Ng-Jun-Xian/3179-A2/main/cardiovascular-disease-death-rate-crude-versus-age-standardized.csv"
      },
      "transform": [
        {"filter": "(datum.Year == 1990 || datum.Year == 2019)"},
        {
          "aggregate": [
            {"op": "mean", "field": "Age-standardized deaths from cardiovascular diseases in both sexes in those aged all ages per 100,000 people", "as": "mean_cvd"}
          ],
          "groupby": ["Year"]
        }
      ],
      "mark": {
        "type": "text",
        "align": "right",
        "dx": 10,
        "dy": -10,
        "fontSize": 14,
        "fontWeight": "bold",
        "color": "#C13838"
      },
      "encoding": {
        "x": {"field": "Year", "type": "quantitative"},
        "y": {"field": "mean_cvd", "type": "quantitative"},
        "text": {
          "field": "mean_cvd",
          "type": "quantitative",
          "format": ".1f"
        }
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Ng-Jun-Xian/3179-A2/main/cardiovascular-disease-death-rate-crude-versus-age-standardized.csv"
      },
      "transform": [
        {"filter": "datum.Year >= 1990 && datum.Year <= 2019"},
        {
          "aggregate": [
            {"op": "mean", "field": "Age-standardized deaths from cardiovascular diseases in both sexes in those aged all ages per 100,000 people", "as": "overall_mean_cvd"}
          ]
        }
      ],
      "mark": {
        "type": "rule",
        "strokeDash": [8, 4],
        "strokeWidth": 2,
        "color": "#C13838"
      },
      "encoding": {
        "y": {"field": "overall_mean_cvd", "type": "quantitative"}
      }
    },
    {
      "data": {"values": [{}]},
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "middle",
        "fontSize": 14,
        "fontWeight": "bold",
        "color": "#8B4513"
      },
      "encoding": {
        "x": {"value": 400},
        "y": {"value": 20},
        "text": {"value": "Coffee Consumption (solid brown line)"}
      }
    },
    {
      "data": {"values": [{}]},
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "middle",
        "fontSize": 14,
        "fontWeight": "bold",
        "color": "#C13838"
      },
      "encoding": {
        "x": {"value": 650},
        "y": {"value": 20},
        "text": {"value": "CVD Deaths (dashed red line)"}
      }
    },
    {
      "data": {"values": [{}]},
      "mark": {
        "type": "text",
        "align": "right",
        "baseline": "top",
        "fontSize": 11,
        "fontStyle": "italic"
      },
      "encoding": {
        "x": {"value": 790},
        "y": {"value": 470},
        "text": {"value": "Data filtered for years 1990-2019 only"}
      }
    }
  ],
  "resolve": {
    "scale": {"y": "independent"}
  },
  "config": {
    "view": {"strokeWidth": 0},
    "axis": {"grid": true, "gridOpacity": 0.3}
  }
}