<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The World of Coffee: A Visual Narrative</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <style>
        /* Root Variables */
        :root {
            --font-serif: 'Playfair Display', serif;
            --font-body: 'Lora', serif;
            --color-background: #FDFDFB;
            --color-text: #1A1A1A;
            --color-accent: #8B4513;
            --color-accent-light: #D4915D;
            --color-subtle: #5A5A5A;
            --color-highlight: #F5EFE7;
            --spacing-unit: 1.5rem;
            --max-width: 1400px;
            --line-height: 1.75;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: var(--line-height);
            font-size: 1.0625rem; /* 17px - BASE BODY TEXT */
        }

        /* Layout Container - Fixed Width */
        .container {
            max-width: var(--max-width);
            margin: 0 auto;
            padding: calc(var(--spacing-unit) * 4) calc(var(--spacing-unit) * 2);
        }

        /* Typography */
        header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 3);
            padding-bottom: calc(var(--spacing-unit) * 3);
            border-bottom: 2px solid var(--color-accent);
        }

        h1 {
            font-family: var(--font-serif);
            font-size: 3.5rem; /* 56px - MAIN TITLE */
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: calc(var(--spacing-unit) * 0.75);
            color: var(--color-accent);
            line-height: 1.1;
        }

        .subtitle {
            font-size: 1.25rem; /* 20px - SUBTITLE */
            font-style: italic;
            color: var(--color-subtle);
            max-width: 42rem;
            margin: 0 auto;
            font-weight: 400;
        }

        h2 {
            font-family: var(--font-serif);
            font-size: 2.5rem; /* 40px - SECTION TITLES */
            font-weight: 700;
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 0.75);
            color: var(--color-text);
            letter-spacing: -0.01em;
            line-height: 1.2;
        }

        .section-intro {
            text-align: center;
            font-size: 1.0625rem; /* 17px - SAME AS BODY (CONSISTENT) */
            color: var(--color-subtle);
            max-width: 50rem;
            margin: 0 auto calc(var(--spacing-unit) * 2.5) auto;
            line-height: 1.6;
            font-style: italic;
        }

        /* Section Dividers */
        hr.divider {
            border: none;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--color-accent-light), transparent);
            margin: calc(var(--spacing-unit) * 4) auto;
            width: 60%;
        }

        /* Grid Layouts - CHART-DOMINANT Layout */
        .section-grid {
            display: grid;
            grid-template-columns: 2.05fr 1fr;
            gap: calc(var(--spacing-unit) * 1.5);
            align-items: start;
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .section-grid.reverse {
            grid-template-columns: 1fr 2.05fr;
            gap: calc(var(--spacing-unit) * 1.5);
        }

        .section-grid.equal {
            grid-template-columns: 1fr 1fr;
            gap: calc(var(--spacing-unit) * 1.5);
        }

        /* Responsive Full-Width Charts */
        .full-width-chart {
            margin-bottom: calc(var(--spacing-unit) * 2);
            width: 100%;
            overflow: visible;
            display: flex;
            justify-content: center;
        }

        .full-width-chart .chart-container {
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        .full-width-chart .chart-container > div {
            width: 100% !important;
            max-width: 100% !important;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .full-width-chart .chart-container > div > div {
            width: 100% !important;
            max-width: 100% !important;
        }
        
        .full-width-chart .chart-container canvas,
        .full-width-chart .chart-container svg {
            max-width: 100% !important;
            width: 100% !important;
        }

        /* Custom Filter Styling */
        .custom-filter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: calc(var(--spacing-unit) * 1) 0;
            background-color: var(--color-highlight);
            border-radius: 4px;
            margin-top: calc(var(--spacing-unit) * 1);
            width: 100%;
        }

        .custom-filter-container label {
            font-family: var(--font-body);
            font-size: 0.9375rem; /* 15px - FILTER LABEL */
            font-weight: 600;
            color: var(--color-text);
            margin-right: 0.75rem;
        }

        .custom-filter-container select {
            font-family: var(--font-body);
            font-size: 0.9375rem; /* 15px - FILTER SELECT */
            padding: 0.5rem 2rem 0.5rem 0.75rem;
            border: 2px solid var(--color-accent-light);
            border-radius: 4px;
            background-color: white;
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238B4513' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
        }

        .custom-filter-container select:hover {
            border-color: var(--color-accent);
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.15);
        }

        .custom-filter-container select:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
        }

        /* Chart containers - Overflow prevention */
        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .chart-container > div {
            width: 100%;
            max-width: 100%;
        }

        /* Force charts inside grid to respect container width */
        .section-grid .chart-container > div,
        .section-grid.reverse .chart-container > div,
        .section-grid.equal .chart-container > div {
            width: 100% !important;
            max-width: 100% !important;
        }

        .section-grid .chart-container svg,
        .section-grid.reverse .chart-container svg,
        .section-grid.equal .chart-container svg,
        .section-grid .chart-container canvas,
        .section-grid.reverse .chart-container canvas,
        .section-grid.equal .chart-container canvas {
            max-width: 100% !important;
            width: 100% !important;
            height: auto !important;
        }

        /* Updated Insight Cards - CONSISTENT TYPOGRAPHY */
        .insights-horizontal {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 1.25);
            margin-top: calc(var(--spacing-unit) * 2);
        }

        .insight-card {
            background-color: var(--color-highlight);
            border-left: 4px solid var(--color-accent);
            padding: calc(var(--spacing-unit) * 1) calc(var(--spacing-unit) * 1.25);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .insight-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .insight-card h3 {
            font-family: var(--font-body);
            font-size: 1.0625rem; /* 17px - INSIGHT CARD TITLES (CONSISTENT) */
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
            color: var(--color-accent);
        }

        .insight-card p {
            margin: 0;
            font-size: 0.9375rem; /* 15px - INSIGHT CARD TEXT */
            color: var(--color-text);
            line-height: 1.6;
        }

        .insights-four-column {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: calc(var(--spacing-unit) * 1);
        }

        .insights-four-column .insight-card {
            padding: calc(var(--spacing-unit) * 0.85) calc(var(--spacing-unit) * 1.1);
        }

        .insights-four-column .insight-card h3 {
            font-size: 1.0625rem; /* 17px - CONSISTENT */
            margin-bottom: calc(var(--spacing-unit) * 0.4);
        }

        .insights-four-column .insight-card p {
            font-size: 0.9375rem; /* 15px - CONSISTENT */
        }

        /* Insights Container in Grid - Vertical Alignment */
        .insights-container {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-unit) * 1.25);
            height: 100%;
            justify-content: center;
        }

        .insights-container .insight-card {
            padding: calc(var(--spacing-unit) * 1) calc(var(--spacing-unit) * 1.25);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .insights-container .insight-card h3 {
            font-size: 1.0625rem; /* 17px - CONSISTENT */
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .insights-container .insight-card p {
            font-size: 0.9375rem; /* 15px - CONSISTENT */
            flex-grow: 1;
        }

        /* Two-card layout - equal height */
        .insights-container.two-cards {
            justify-content: flex-start;
        }

        .insights-container.two-cards .insight-card {
            flex: 0 1 auto;
        }

        /* Section Spacing */
        section {
            margin-bottom: calc(var(--spacing-unit) * 5);
        }

        /* Footer */
        .metadata-footer {
            text-align: left;
            padding: calc(var(--spacing-unit) * 2) 0;
            margin-top: calc(var(--spacing-unit) * 6);
            border-top: 2px solid var(--color-accent);
            color: var(--color-subtle);
        }

        .metadata-footer p {
            margin: calc(var(--spacing-unit) * 0.33) 0;
            font-size: 0.9375rem; /* 15px - FOOTER TEXT */
            line-height: 1.6;
        }

        .metadata-footer strong {
            color: var(--color-text);
            font-weight: 600;
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .container {
                max-width: 95%;
            }
        }

        @media (max-width: 900px) {
            .section-grid,
            .section-grid.reverse,
            .section-grid.equal {
                grid-template-columns: 1fr;
                gap: calc(var(--spacing-unit) * 2);
            }

            .insights-horizontal {
                grid-template-columns: 1fr;
                gap: calc(var(--spacing-unit) * 1);
            }
            
            .insights-four-column {
                grid-template-columns: 1fr 1fr;
            }

            .container {
                padding: calc(var(--spacing-unit) * 2.5) calc(var(--spacing-unit) * 1.5);
            }

            h1 {
                font-size: 2.5rem;
            }

            h2 {
                font-size: 2rem;
            }
        }

        @media (max-width: 600px) {
            body {
                font-size: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.75rem;
            }

            .section-intro {
                font-size: 1rem;
                margin-bottom: calc(var(--spacing-unit) * 2);
            }

            .insight-card {
                padding: calc(var(--spacing-unit) * 0.75) calc(var(--spacing-unit) * 1);
            }
            
            .insight-card h3 {
                font-size: 0.95rem;
            }
            
            .insight-card p {
                font-size: 0.875rem;
            }
            
            .insights-four-column {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 1);
            }
            
            .full-width-chart {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body>

    <div class="container">

        <header>
            <h1>The World of Coffee</h1>
            <p class="subtitle">From the fertile soils of the Bean Belt to the world's favorite cup, explore the global story of coffee through data and discovery.</p>
        </header>

        <!-- Section 1: Origins -->
        <section>
            <h2>Where Coffee Grows: The Bean Belt</h2>
            <p class="section-intro">The narrow equatorial zone where <strong>climate meets altitude</strong> to create perfect growing conditions.</p>
            
            <div class="full-width-chart">
                <div class="chart-container">
                    <div>
                        <div id="map_coffee_production"></div>
                        <div class="custom-filter-container">
                            <label for="coffeeTypeSelect">Filter by Coffee Type:</label>
                            <select id="coffeeTypeSelect">
                                <option value="all">All Coffee Types</option>
                                <option value="Arabica">Arabica</option>
                                <option value="Robusta">Robusta</option>
                                <option value="Arabica/Robusta">Arabica/Robusta</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="insights-horizontal">
                <div class="insight-card">
                    <h3>The Bean Belt Geography</h3>
                    <p>Coffee production concentrates in the <strong>equatorial zone</strong> where consistent temperatures, distinct wet and dry seasons, and <strong>high altitudes</strong> create ideal growing conditions.</p>
                </div>
                <div class="insight-card">
                    <h3>Brazilian Dominance</h3>
                    <p><strong>Brazil</strong> stands as the undisputed leader, producing <strong>more coffee than any other nation</strong> and shaping global market dynamics through its vast plantations.</p>
                </div>
                <div class="insight-card">
                    <h3>African Heritage</h3>
                    <p><strong>Ethiopia</strong>, where coffee was first discovered, continues as a major <strong>Arabica producer</strong>, maintaining traditions that date back centuries.</p>
                </div>
            </div>
            
            <div class="section-grid" style="margin-top: calc(var(--spacing-unit) * 3);">
                <div class="chart-container">
                    <div id="area_chart_production"></div>
                </div>
                <div class="insights-container">
                    <div class="insight-card">
                        <h3>Three Decades of Growth</h3>
                        <p>Global coffee production has grown steadily from <strong>1990 to 2020</strong>, with the <strong>top five producers</strong> consistently dominating the market and accounting for the majority of worldwide output.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Vietnam's Remarkable Ascent</h3>
                        <p><strong>Vietnam's production</strong> expanded dramatically during this period, transforming from a minor player to the <strong>world's second-largest producer</strong> through focused investment in Robusta cultivation.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Market Stability</h3>
                        <p>Despite weather challenges and market fluctuations, the top producers have maintained <strong>relatively stable production levels</strong>, ensuring consistent global supply.</p>
                    </div>
                </div>
            </div>
            
            <div class="section-grid reverse" style="margin-top: calc(var(--spacing-unit) * 2);">
                <div class="insights-container">
                    <div class="insight-card">
                        <h3>Regional Shifts Over Time</h3>
                        <p><strong>The Americas</strong> have maintained consistent production leadership, while <strong>Asia-Pacific</strong> has experienced remarkable growth, particularly driven by Vietnam's expansion into Robusta coffee since the 1990s.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Africa's Steady Contribution</h3>
                        <p><strong>African nations</strong> maintain stable production levels, focusing on <strong>high-quality Arabica varieties</strong> that command premium prices in specialty markets.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Continental Balance</h3>
                        <p>The distribution across <strong>three major regions</strong> creates a balanced global supply chain, with each continent contributing unique varieties and processing traditions.</p>
                    </div>
                </div>
                <div class="chart-container">
                    <div id="Regional_coffee_production"></div>
                </div>
            </div>
        </section>

        <hr class="divider">

        <!-- Section 2: Global Trade -->
        <section>
            <h2>The Global Coffee Trade Network</h2>
            <p class="section-intro">Connecting <strong>mountain farmers</strong> with <strong>morning commuters</strong> across every continent.</p>
            
            <div class="full-width-chart">
                <div class="chart-container">
                    <div id="flow_import_export"></div>
                </div>
            </div>
            
            <div class="insights-horizontal">
                <div class="insight-card">
                    <h3>A Web of Global Commerce</h3>
                    <p><strong>Brazil</strong> sends massive coffee shipments to the <strong>US</strong>, Vietnam's exports to <strong>Europe</strong> are growing fast, and Colombia maintains steady trade—together forming a global network that delivers your daily coffee.</p>
                </div>
                <div class="insight-card">
                    <h3>The Power of the Few</h3>
                    <p>Just <strong>10 exporters and importers</strong> drive most of the coffee trade. When Brazil or Vietnam face problems, <strong>coffee prices react worldwide</strong> almost immediately.</p>
                </div>
                <div class="insight-card">
                    <h3>Europe's Strategic Position</h3>
                    <p><strong>Belgium, the Netherlands, and Germany</strong> serve as Europe's main coffee gateways, importing beans, roasting them, and distributing across the continent.</p>
                </div>
            </div>
            
            <div class="section-grid equal" style="margin-top: calc(var(--spacing-unit) * 3);">
                <div class="chart-container">
                    <div id="Top5_exporters"></div>
                </div>
                <div class="chart-container">
                    <div id="Top5_importers"></div>
                </div>
            </div>
            
            <div class="insights-four-column" style="margin-top: calc(var(--spacing-unit) * 2);">
                <div class="insight-card">
                    <h3>Brazil's Unshaken Throne</h3>
                    <p>Brazil exports <strong>20-30 billion kg</strong> of coffee yearly, with its <strong>Santos port</strong> handling more beans than most countries produce.</p>
                </div>
                <div class="insight-card">
                    <h3>Vietnam's Dramatic Ascent</h3>
                    <p>Vietnam quickly rose to become a <strong>major exporter</strong> by shifting millions of farmers from rice to coffee in just a few decades.</p>
                </div>
                <div class="insight-card">
                    <h3>America's Insatiable Appetite</h3>
                    <p>The <strong>US imports over 1.3 billion kg</strong> of coffee, driving strong global demand from both traditional and specialty coffee lovers.</p>
                </div>
                <div class="insight-card">
                    <h3>Germany's Coffee Gateway</h3>
                    <p><strong>Germany</strong> imports and roasts green coffee beans before sending them across Europe, with <strong>Hamburg's port</strong> rivaling Brazil's Santos in importance.</p>
                </div>
            </div>
        </section>

        <hr class="divider">

        <!-- Section 3: Coffee Consumption -->
        <section>
            <h2>Coffee Consumption Around the World</h2>
            <p class="section-intro">From <strong>Nordic coffee rituals</strong> to <strong>emerging markets</strong>, how the world drinks its coffee.</p>
            
            <div class="full-width-chart">
                <div class="chart-container">
                    <div>
                        <div id="linechart_coffee_consumption"></div>
                        <div class="custom-filter-container">
                            <label for="consumptionCountrySelect">Filter by Country:</label>
                            <select id="consumptionCountrySelect">
                                <option value="all">All Countries (Global Average)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="insights-horizontal">
                <div class="insight-card">
                    <h3>Steady Global Growth</h3>
                    <p>Average per capita coffee consumption has grown consistently over <strong>three decades</strong>, rising from <strong>1.19 kg in 1990 to 1.31 kg by 2019</strong>, reflecting coffee's expanding role in daily life worldwide.</p>
                </div>
                <div class="insight-card">
                    <h3>Universal Appeal</h3>
                    <p>The upward trend crosses <strong>all continents and cultures</strong>, demonstrating coffee's unique ability to transcend geographic and cultural boundaries as both commodity and cultural touchstone.</p>
                </div>
                <div class="insight-card">
                    <h3>The New Normal</h3>
                    <p>What was once a luxury has become a <strong>daily necessity</strong>. Coffee shops multiply in cities worldwide, and <strong>morning coffee rituals</strong> define routines from Tokyo to São Paulo.</p>
                </div>
            </div>

            <div class="section-grid" style="margin-top: calc(var(--spacing-unit) * 3);">
                <div class="chart-container">
                    <div id="Bar_country_comsumption"></div>
                </div>
                <div class="insights-container">
                    <div class="insight-card">
                        <h3>Northern Leaders</h3>
                        <p>European countries, especially <strong>Luxembourg, Finland, and Norway</strong>, top the list for coffee consumption per person, highlighting coffee's <strong>strong cultural roots in the north</strong>.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Global Diversity</h3>
                        <p>Coffee habits vary widely, with some smaller nations and major producers showing <strong>moderate per capita consumption</strong>, reflecting different cultures and traditions around the world.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Producing Nations Drink Less</h3>
                        <p>Surprisingly, major coffee producers like <strong>Brazil and Costa Rica</strong> show <strong>moderate consumption rates</strong>, as most of their premium beans are exported to satisfy global demand rather than consumed locally.</p>
                    </div>
                </div>
            </div>
            
            <div class="section-grid reverse" style="margin-top: calc(var(--spacing-unit) * 2);">
                <div class="insights-container">
                    <div class="insight-card">
                        <h3>Arabica Dominance</h3>
                        <p>Most domestic coffee consumption leans heavily toward <strong>Arabica varieties</strong>, prized for their <strong>flavor and quality</strong>, especially in established producing countries like Ethiopia and Brazil.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Robusta's Role</h3>
                        <p><strong>Robusta coffee</strong> plays a significant role in countries focusing on <strong>higher yield and resilience</strong>, notably in Vietnam and parts of Asia, highlighting diverse consumption patterns aligned with local production.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Vietnam's Unique Profile</h3>
                        <p>As the world's largest <strong>Robusta producer</strong>, Vietnam also leads in <strong>domestic Robusta consumption</strong>, reflecting a cultural preference aligned with local agricultural strengths and creating a distinct coffee tradition.</p>
                    </div>
                </div>
                <div class="chart-container">
                    <div id="Domestic_consumption_radial"></div>
                </div>
            </div>
        </section>

        <hr class="divider">

        <!-- Section 4: Coffee & GDP -->
        <section>
            <h2>Coffee and Economic Prosperity</h2>
            <p class="section-intro">Wealthier nations drink more coffee—exploring the link between <strong>prosperity and productivity</strong>.</p>
            
            <div class="full-width-chart">
                <div class="chart-container">
                    <div id="gdp_consumption_correlation"></div>
                </div>
            </div>
            
            <div class="insights-horizontal">
                <div class="insight-card">
                    <h3>Coffee and Wealth Go Hand in Hand</h3>
                    <p>Countries with <strong>higher income levels</strong> tend to drink more coffee per person, suggesting that coffee culture often thrives where <strong>economic prosperity</strong> supports both access and lifestyle habits.</p>
                </div>
                <div class="insight-card">
                    <h3>Small Nations, Big Coffee Passion</h3>
                    <p>Some <strong>smaller countries</strong> outpace the giants in per capita coffee consumption, showing that love for coffee isn't just about size—it's a <strong>cultural passion</strong> that fuels daily productivity.</p>
                </div>
                <div class="insight-card">
                    <h3>Productivity in Every Sip</h3>
                    <p>The <strong>correlation between coffee drinking and GDP</strong> reflects coffee's role in <strong>boosting alertness and focus</strong>, helping workers worldwide power through their tasks and contribute to their economies.</p>
                </div>
            </div>
        </section>

        <hr class="divider">

        <!-- Section 5: Coffee & Cardiovascular Health -->
        <section>
            <h2>Coffee and Heart Health</h2>
            <p class="section-intro">As coffee consumption rises, <strong>heart disease deaths decline</strong>—a surprising correlation.</p>
            
            <div class="full-width-chart">
                <div class="chart-container">
                    <div id="dual_axis_coffee_cvd"></div>
                </div>
            </div>
            
            <div class="insights-horizontal">
                <div class="insight-card">
                    <h3>Coffee Up, Heart Disease Down</h3>
                    <p>From 1990 to 2019, global coffee consumption climbed <strong>24%</strong> while cardiovascular deaths dropped by <strong>44%</strong>—a pattern that challenges outdated fears about coffee and heart health.</p>
                </div>
                <div class="insight-card">
                    <h3>Antioxidants at Work</h3>
                    <p>Coffee is packed with <strong>polyphenols and antioxidants</strong> that fight inflammation and protect blood vessels, potentially explaining why regular drinkers often show <strong>better heart health markers</strong>.</p>
                </div>
                <div class="insight-card">
                    <h3>Moderation Matters</h3>
                    <p>Studies suggest <strong>3-5 cups daily</strong> hits the sweet spot for cardiovascular benefits—enough to harness coffee's protective compounds without overdoing the caffeine.</p>
                </div>
            </div>
        </section>

        <hr class="divider">

        <!-- Section 6: Coffee Processing -->
        <section>
            <h2>How Processing Shapes Flavor</h2>
            <p class="section-intro">Each processing method creates a <strong>unique flavor profile</strong>—from bold and fruity to bright and clean.</p>
            
            <div class="full-width-chart">
                <div class="chart-container">
                    <div id="process_method_cup_points"></div>
                </div>
            </div>
            
            <div class="insights-horizontal">
                <div class="insight-card">
                    <h3>Natural Processing: Bold & Fruity</h3>
                    <p>Drying beans with the fruit intact creates <strong>intense flavor and sweetness</strong>, scoring highest in aroma and body—perfect for those who love a <strong>full-bodied, fruit-forward cup</strong>.</p>
                </div>
                <div class="insight-card">
                    <h3>Washed Method: Bright & Clean</h3>
                    <p>Removing the fruit before drying produces <strong>higher acidity and clarity</strong>, delivering that <strong>crisp, refreshing taste</strong> favored by specialty coffee enthusiasts seeking pure bean character.</p>
                </div>
                <div class="insight-card">
                    <h3>Semi-Washed: The Best of Both</h3>
                    <p>A hybrid approach balances <strong>sweetness and acidity</strong>, offering moderate body with clean aftertaste—an <strong>approachable middle ground</strong> for exploring coffee's diverse flavor spectrum.</p>
                </div>
            </div>
        </section>  
        
       <!-- Footer INSIDE container -->
        <footer class="metadata-footer">
            <p><strong>Author:</strong> Ng Jun Xian</p>
            <p><strong>Date Created:</strong> 20 October 2025</p>
            <p><strong>Data Sources:</strong></p>
            <p style="margin-left: 1.5rem; margin-top: 0.5rem;">
                • Coffee Production & Trade: 
                <a href="https://www.kaggle.com/datasets/michals22/coffee-dataset/data" target="_blank" rel="noopener noreferrer" style="color: var(--color-accent); text-decoration: underline;">Coffee Dataset (Kaggle)</a>
            </p>
            <p style="margin-left: 1.5rem;">
                • Coffee Processing Methods: 
                <a href="https://corgis-edu.github.io/corgis/csv/coffee/" target="_blank" rel="noopener noreferrer" style="color: var(--color-accent); text-decoration: underline;">CORGIS Coffee Dataset</a>
            </p>
            <p style="margin-left: 1.5rem;">
                • Cardiovascular Disease Statistics: 
                <a href="https://ourworldindata.org/grapher/cardiovascular-disease-death-rate-crude-versus-age-standardized" target="_blank" rel="noopener noreferrer" style="color: var(--color-accent); text-decoration: underline;">Our World in Data</a>
            </p>
            <p style="margin-left: 1.5rem;">
                • GDP Per Capita: 
                <a href="https://data.worldbank.org/indicator/SL.GDP.PCAP.EM.KD?name_desc=false" target="_blank" rel="noopener noreferrer" style="color: var(--color-accent); text-decoration: underline;">World Bank Development Indicators</a>
            </p>
            <p style="margin-left: 1.5rem;">
                • Population Data: 
                <a href="https://data.worldbank.org/indicator/SP.POP.TOTL" target="_blank" rel="noopener noreferrer" style="color: var(--color-accent); text-decoration: underline;">World Bank Development Indicators</a>
            </p>
            <p><strong>Visualization Tools:</strong> Vega-Lite v5, Vega v5</p>
        </footer>
    </div>

    <script>
        let mapView = null;
        let consumptionView = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Coffee type filter handler for map
            document.getElementById('coffeeTypeSelect').addEventListener('change', function(e) {
                const selectedType = e.target.value;
                if (mapView) {
                    if (selectedType === 'all') {
                        mapView.signal('coffeeTypeFilter', null).run();
                    } else {
                        mapView.signal('coffeeTypeFilter', selectedType).run();
                    }
                }
            });

            // Country filter handler for consumption chart
            document.getElementById('consumptionCountrySelect').addEventListener('change', function(e) {
                const selectedCountry = e.target.value;
                if (consumptionView) {
                    if (selectedCountry === 'all') {
                        consumptionView.signal('countryFilter', null).run();
                    } else {
                        consumptionView.signal('countryFilter', selectedCountry).run();
                    }
                }
            });

            // Populate country filter from CSV
            fetch('Coffee_consumption_per_capita.csv')
                .then(response => response.text())
                .then(data => {
                    const lines = data.split('\n');
                    const countries = new Set();
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (line) {
                            const country = line.split(',')[0].replace(/^"|"$/g, '');
                            if (country) countries.add(country);
                        }
                    }
                    
                    const sortedCountries = Array.from(countries).sort();
                    const select = document.getElementById('consumptionCountrySelect');
                    
                    sortedCountries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country;
                        option.textContent = country;
                        select.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading countries:', error));

            const fullWidthCharts = [
                'gdp_consumption_correlation',
                'dual_axis_coffee_cvd',
                'process_method_cup_points'
            ];
            
            const sideCharts = [
                'area_chart_production',
                'Regional_coffee_production',
                'flow_import_export',
                'Top5_exporters',
                'Top5_importers',
                'Bar_country_comsumption',
                'Domestic_consumption_radial'
            ];

            vegaEmbed('#map_coffee_production', 'map_coffee_production.json', { 
                "actions": false,
                "renderer": "svg"
            }).then(result => {
                mapView = result.view;
            }).catch(error => {
                console.error('Error loading map:', error);
                document.getElementById('map_coffee_production').innerHTML = '<p style="color: #999; text-align: center; padding: 2rem;">Map could not be loaded.</p>';
            });

            vegaEmbed('#linechart_coffee_consumption', 'linechart_coffee_consumption.json', { 
                "actions": false,
                "renderer": "svg"
            }).then(result => {
                consumptionView = result.view;
            }).catch(error => {
                console.error('Error loading consumption chart:', error);
                document.getElementById('linechart_coffee_consumption').innerHTML = '<p style="color: #999; text-align: center; padding: 2rem;">Chart could not be loaded.</p>';
            });

            fullWidthCharts.forEach(chartId => {
                const element = document.getElementById(chartId);
                if (element) {
                    vegaEmbed(`#${chartId}`, `${chartId}.json`, { 
                        "actions": false,
                        "renderer": "svg"
                    }).catch(error => {
                        console.error(`Error loading ${chartId}:`, error);
                        element.innerHTML = `<p style="color: #999; text-align: center; padding: 2rem;">Chart could not be loaded.</p>`;
                    });
                }
            });

            sideCharts.forEach(chartId => {
                const element = document.getElementById(chartId);
                if (element) {
                    vegaEmbed(`#${chartId}`, `${chartId}.json`, { 
                        "actions": false,
                        "renderer": "svg"
                    }).catch(error => {
                        console.error(`Error loading ${chartId}:`, error);
                        element.innerHTML = `<p style="color: #999; text-align: center; padding: 2rem;">Chart could not be loaded.</p>`;
                    });
                }
            });
        });
    </script>

</body>
</html>