{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Coffee Consumption Trends: Top 5 Countries (1990â€“2019)",
    "subtitle": "Detailed per-capita consumption patterns for the highest consuming nations",
    "anchor": "middle",
    "fontSize": 18,
    "fontWeight": "bold"
  },
  "data": {"url": "Coffee_consumption_per_capita.csv"},
  "transform": [
    {
      "aggregate": [
        {"op": "mean", "field": "Consumption_Per_Capita_kg", "as": "avg_consumption"}
      ],
      "groupby": ["Country"]
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "avg_consumption", "order": "descending"}]
    },
    {"filter": "datum.rank <= 5"},
    {
      "lookup": "Country",
      "from": {
        "data": {"url": "Coffee_consumption_per_capita.csv"},
        "key": "Country",
        "fields": [
          "Year",
          "Consumption_Per_Capita_kg",
          "Total_Consumption",
          "Coffee type"
        ]
      }
    },
    {"filter": "isValid(datum.Consumption_Per_Capita_kg) && datum.Consumption_Per_Capita_kg > 0"}
  ],
  "facet": {
    "field": "Country",
    "type": "nominal",
    "columns": 3,
    "title": null,
    "header": {
      "labelFontSize": 14,
      "labelFontWeight": "bold",
      "labelColor": "#8B4513"
    },
    "sort": {"field": "avg_consumption", "order": "descending"}
  },
  "spec": {
    "width": 250,
    "height": 200,
    "resolve": {"scale": {"y": "independent"}},
    "layer": [
      {
        "mark": {
          "type": "area",
          "opacity": 0.25,
          "color": "#FFD700",
          "line": {"color": "#8B4513", "strokeWidth": 2}
        },
        "encoding": {
          "x": {
            "field": "Year",
            "type": "quantitative",
            "title": "Year",
            "scale": {"domain": [1990, 2019]},
            "axis": {"format": "d", "tickCount": 6, "labelFontSize": 11}
          },
          "y": {
            "field": "Consumption_Per_Capita_kg",
            "type": "quantitative",
            "title": "Per Capita Consumption (kg)",
            "axis": {"labelFontSize": 11}
          }
        }
      },
      {
        "mark": {"type": "point", "filled": true, "size": 45, "color": "#8B4513", "opacity": 0.7},
        "encoding": {
          "x": {"field": "Year", "type": "quantitative"},
          "y": {"field": "Consumption_Per_Capita_kg", "type": "quantitative"},
          "tooltip": [
            {"field": "Country"},
            {"field": "Year"},
            {"field": "Consumption_Per_Capita_kg", "title": "Per Capita (kg)", "format": ".2f"},
            {"field": "Total_Consumption", "title": "Total (kg)", "format": ",.0f"}
          ]
        }
      },
      {
        "transform": [{"filter": "datum.Year == 2019"}],
        "mark": {
          "type": "text",
          "align": "left",
          "dx": 5,
          "dy": -5,
          "fontSize": 11,
          "fontWeight": "bold",
          "color": "#8B4513"
        },
        "encoding": {
          "x": {"field": "Year"},
          "y": {"field": "Consumption_Per_Capita_kg"},
          "text": {"field": "Consumption_Per_Capita_kg", "format": ".2f"}
        }
      }
    ]
  },
  "config": {
    "view": {"strokeWidth": 0},
    "axis": {"grid": true, "gridOpacity": 0.3}
  }
}
